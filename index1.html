<!DOCTYPE html>
<html lang="zh-TW">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>ğŸ“° æ–°èæ”¶é›†ç³»çµ±</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <link rel="manifest" href="manifest.json">
   <style>
       /* åŸºç¤æ¨£å¼é‡ç½® */
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }
      
       :root {
           --primary: #4285f4;
           --primary-dark: #3367d6;
           --secondary: #34a853;
           --secondary-dark: #2d8c47;
           --danger: #ea4335;
           --warning: #fbbc05;
           --light: #f8f9fa;
           --dark: #202124;
           --gray: #5f6368;
           --light-gray: #dadce0;
           --card-shadow: 0 2px 8px rgba(0,0,0,0.1);
           --card-shadow-hover: 0 8px 24px rgba(0,0,0,0.15);
           --transition: all 0.3s ease;
       }
      
       body {
           font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
           background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
           color: var(--dark);
           line-height: 1.6;
           min-height: 100vh;
           padding: 20px;
       }
      
       .container {
           max-width: 1400px;
           margin: 0 auto;
       }
      
       /* é é¦–æ¨£å¼ */
       .header {
           background: white;
           border-radius: 16px;
           padding: 30px;
           margin-bottom: 30px;
           box-shadow: var(--card-shadow);
           text-align: center;
           position: relative;
           overflow: hidden;
       }
      
       .header::before {
           content: '';
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 4px;
           background: linear-gradient(90deg, var(--primary), var(--secondary), var(--warning), var(--danger));
       }
      
       .header h1 {
           font-size: 2.5rem;
           margin-bottom: 10px;
           color: var(--dark);
       }
      
       .header p {
           color: var(--gray);
           font-size: 1.1rem;
           max-width: 800px;
           margin: 0 auto;
       }
      
       /* æ§åˆ¶é¢æ¿ */
       .controls {
           display: flex;
           gap: 12px;
           margin-bottom: 30px;
           flex-wrap: wrap;
           justify-content: center;
       }
      
       .btn {
           padding: 12px 24px;
           border: none;
           border-radius: 8px;
           font-size: 1rem;
           font-weight: 600;
           cursor: pointer;
           transition: var(--transition);
           display: inline-flex;
           align-items: center;
           gap: 8px;
       }
      
       .btn-primary {
           background: var(--primary);
           color: white;
       }
      
       .btn-primary:hover {
           background: var(--primary-dark);
           transform: translateY(-2px);
           box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
       }
      
       .btn-secondary {
           background: var(--secondary);
           color: white;
       }
      
       .btn-secondary:hover {
           background: var(--secondary-dark);
           transform: translateY(-2px);
           box-shadow: 0 4px 12px rgba(52, 168, 83, 0.3);
       }
      
       .btn-outline {
           background: white;
           color: var(--primary);
           border: 2px solid var(--primary);
       }
      
       .btn-outline:hover {
           background: var(--primary);
           color: white;
       }
      
       /* ç‹€æ…‹é¡¯ç¤º */
       .status-bar {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
           gap: 20px;
           margin-bottom: 30px;
       }
      
       .status-card {
           background: white;
           padding: 20px;
           border-radius: 12px;
           box-shadow: var(--card-shadow);
           text-align: center;
           transition: var(--transition);
       }
      
       .status-card:hover {
           transform: translateY(-5px);
           box-shadow: var(--card-shadow-hover);
       }
      
       .status-icon {
           font-size: 2.5rem;
           margin-bottom: 15px;
       }
      
       .status-value {
           font-size: 2.2rem;
           font-weight: 700;
           color: var(--primary);
           margin-bottom: 5px;
       }
      
       .status-label {
           color: var(--gray);
           font-size: 0.95rem;
       }
      
       /* è¼‰å…¥å‹•ç•« */
       .loading {
           text-align: center;
           padding: 60px 20px;
           background: white;
           border-radius: 16px;
           box-shadow: var(--card-shadow);
           margin-bottom: 30px;
       }
      
       .loader {
           width: 60px;
           height: 60px;
           border: 5px solid #f3f3f3;
           border-top: 5px solid var(--primary);
           border-radius: 50%;
           animation: spin 1s linear infinite;
           margin: 0 auto 25px;
       }
      
       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }
      
       /* éŒ¯èª¤è¨Šæ¯ */
       .error-message {
           background: #ffebee;
           color: var(--danger);
           padding: 20px;
           border-radius: 12px;
           margin-bottom: 30px;
           border-left: 5px solid var(--danger);
           display: flex;
           align-items: center;
           gap: 12px;
       }
      
       /* æœ€å¾Œæ›´æ–°æ™‚é–“ */
       .last-updated {
           text-align: center;
           color: var(--gray);
           margin-bottom: 25px;
           padding: 15px;
           background: white;
           border-radius: 12px;
           box-shadow: var(--card-shadow);
       }
      
       /* ç†±é–€é—œéµå­— */
       .hot-keywords {
           background: white;
           border-radius: 16px;
           padding: 25px;
           margin-bottom: 30px;
           box-shadow: var(--card-shadow);
       }
      
       .section-title {
           display: flex;
           align-items: center;
           gap: 10px;
           margin-bottom: 20px;
           font-size: 1.5rem;
           color: var(--dark);
       }
      
       .keywords-container {
           display: flex;
           flex-wrap: wrap;
           gap: 12px;
       }
      
       .keyword-tag {
           padding: 8px 16px;
           background: linear-gradient(135deg, var(--primary), #5c6bc0);
           color: white;
           border-radius: 20px;
           font-weight: 500;
           display: inline-flex;
           align-items: center;
           gap: 6px;
           transition: var(--transition);
           cursor: pointer;
       }
      
       .keyword-tag:hover {
           transform: scale(1.05);
           box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
       }
      
       .keyword-count {
           background: rgba(255, 255, 255, 0.2);
           padding: 2px 8px;
           border-radius: 10px;
           font-size: 0.85rem;
       }
      
       /* ç¯©é¸å™¨ */
       .filters {
           display: flex;
           flex-wrap: wrap;
           gap: 10px;
           margin-bottom: 30px;
           justify-content: center;
       }
      
       .filter-btn {
           padding: 8px 20px;
           border: 2px solid var(--light-gray);
           background: white;
           border-radius: 20px;
           cursor: pointer;
           transition: var(--transition);
           font-weight: 500;
       }
      
       .filter-btn.active {
           background: var(--primary);
           color: white;
           border-color: var(--primary);
       }
      
       .filter-btn:hover:not(.active) {
           border-color: var(--primary);
           color: var(--primary);
       }
      
       /* æ–°èå¡ç‰‡ */
       .news-grid {
           display: grid;
           grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
           gap: 25px;
           margin-bottom: 40px;
       }
      
       .news-card {
           background: white;
           border-radius: 16px;
           overflow: hidden;
           box-shadow: var(--card-shadow);
           transition: var(--transition);
           display: flex;
           flex-direction: column;
       }
      
       .news-card:hover {
           transform: translateY(-8px);
           box-shadow: var(--card-shadow-hover);
       }
      
       .news-category {
           padding: 10px 20px;
           color: white;
           font-weight: 600;
           text-align: center;
       }
      
       .category-tech { background: var(--primary); }
       .category-finance { background: var(--secondary); }
       .category-politics { background: #9c27b0; }
       .category-health { background: #00bcd4; }
       .category-environment { background: #4caf50; }
       .category-education { background: #ff9800; }
       .category-sports { background: #e91e63; }
       .category-entertainment { background: #673ab7; }
       .category-other { background: var(--gray); }
      
       .news-content {
           padding: 25px;
           flex-grow: 1;
           display: flex;
           flex-direction: column;
       }
      
       .news-title {
           font-size: 1.3rem;
           font-weight: 600;
           margin-bottom: 15px;
           color: var(--dark);
           line-height: 1.4;
       }
      
       .news-summary {
           color: var(--gray);
           margin-bottom: 20px;
           line-height: 1.6;
           font-size: 0.95rem;
           flex-grow: 1;
       }
      
       .news-meta {
           display: flex;
           justify-content: space-between;
           align-items: center;
           font-size: 0.9rem;
           color: var(--gray);
           padding-top: 20px;
           border-top: 1px solid var(--light-gray);
           margin-top: auto;
       }
      
       .news-source {
           font-weight: 600;
           color: var(--primary);
           display: flex;
           align-items: center;
           gap: 6px;
       }
      
       .news-date {
           color: var(--gray);
       }
      
       .news-link {
           display: inline-flex;
           align-items: center;
           gap: 6px;
           color: var(--primary);
           text-decoration: none;
           font-weight: 600;
           transition: var(--transition);
           margin-top: 15px;
       }
      
       .news-link:hover {
           color: var(--primary-dark);
           gap: 10px;
       }
      
       /* é å°¾ */
       .footer {
           text-align: center;
           padding: 25px;
           color: var(--gray);
           font-size: 0.9rem;
           background: white;
           border-radius: 16px;
           box-shadow: var(--card-shadow);
           margin-top: 40px;
       }
      
       /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
       @media (max-width: 768px) {
           .header h1 { font-size: 2rem; }
           .news-grid { grid-template-columns: 1fr; }
           .status-bar { grid-template-columns: 1fr 1fr; }
           .controls { flex-direction: column; }
           .btn { justify-content: center; }
           body { padding: 15px; }
       }
      
       @media (max-width: 480px) {
           .status-bar { grid-template-columns: 1fr; }
           .header h1 { font-size: 1.8rem; }
           .header { padding: 20px; }
           body { padding: 10px; }
       }
   </style>
</head>
<body>
   <div class="container">
       <!-- é é¦– -->
       <div class="header">
           <h1><i class="fas fa-newspaper"></i> æ–°èæ”¶é›†ç³»çµ±</h1>
           <p>å³æ™‚æ”¶é›†ã€åˆ†æèˆ‡å‘ˆç¾å„å¤§æ–°èä¾†æºçš„æœ€æ–°è³‡è¨Š</p>
       </div>
      
       <!-- æ§åˆ¶æŒ‰éˆ• -->
       <div class="controls">
           <button class="btn btn-primary" onclick="loadNews()">
               <i class="fas fa-sync-alt"></i> æ›´æ–°æ–°è
           </button>
           <button class="btn btn-secondary" onclick="showStats()">
               <i class="fas fa-chart-bar"></i> æª¢è¦–çµ±è¨ˆ
           </button>
           <button class="btn btn-outline" onclick="filterNews('all')">
               <i class="fas fa-filter"></i> é¡¯ç¤ºå…¨éƒ¨
           </button>
           <button class="btn btn-outline" onclick="testConnection()">
               <i class="fas fa-wifi"></i> æ¸¬è©¦é€£ç·š
           </button>
       </div>
      
       <!-- ç‹€æ…‹é¡¯ç¤º -->
       <div class="status-bar" id="statusBar">
           <div class="status-card">
               <div class="status-icon"><i class="fas fa-newspaper" style="color: var(--primary);"></i></div>
               <div class="status-value" id="totalNews">0</div>
               <div class="status-label">ç¸½æ–°èæ•¸</div>
           </div>
           <div class="status-card">
               <div class="status-icon"><i class="fas fa-rss" style="color: var(--secondary);"></i></div>
               <div class="status-value" id="totalSources">0</div>
               <div class="status-label">æ–°èä¾†æº</div>
           </div>
           <div class="status-card">
               <div class="status-icon"><i class="fas fa-tags" style="color: #9c27b0;"></i></div>
               <div class="status-value" id="totalCategories">0</div>
               <div class="status-label">æ–°èåˆ†é¡</div>
           </div>
           <div class="status-card">
               <div class="status-icon"><i class="fas fa-clock" style="color: var(--warning);"></i></div>
               <div class="status-value" id="lastUpdateTime">--:--</div>
               <div class="status-label">æœ€å¾Œæ›´æ–°</div>
           </div>
       </div>
      
       <!-- è¼‰å…¥æŒ‡ç¤ºå™¨ -->
       <div class="loading" id="loading" style="display: none;">
           <div class="loader"></div>
           <p>æ­£åœ¨è¼‰å…¥æ–°èè³‡æ–™...</p>
       </div>
      
       <!-- éŒ¯èª¤è¨Šæ¯ -->
       <div class="error-message" id="errorMessage" style="display: none;">
           <i class="fas fa-exclamation-triangle"></i>
           <div id="errorText"></div>
       </div>
      
       <!-- æœ€å¾Œæ›´æ–°æ™‚é–“ -->
       <div class="last-updated" id="lastUpdated">
           <i class="fas fa-clock"></i> æœ€å¾Œæ›´æ–°æ™‚é–“: <span id="updateTimeText">å°šæœªæ›´æ–°</span>
       </div>
      
       <!-- ç†±é–€é—œéµå­—å€ -->
       <div class="hot-keywords" id="hotKeywordsSection" style="display: none;">
           <h2 class="section-title"><i class="fas fa-fire"></i> ç†±é–€é—œéµå­—</h2>
           <div class="keywords-container" id="keywordsContainer"></div>
       </div>
      
       <!-- æ–°èåˆ†é¡ç¯©é¸ -->
       <div class="filters" id="filtersSection" style="display: none;"></div>
      
       <!-- æ–°èåˆ—è¡¨ -->
       <div class="news-grid" id="newsContainer">
           <!-- æ–°èå¡ç‰‡æœƒå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
       </div>
      
       <!-- é å°¾ -->
       <div class="footer">
           <p><i class="fas fa-code"></i> æ–°èæ”¶é›†ç³»çµ± v2.1.0</p>
           <p>è³‡æ–™ä¾†æºï¼šä¸­å¤®ç¤¾ã€ETtodayã€è‡ªç”±æ™‚å ±</p>
           <p>æ›´æ–°é »ç‡ï¼šæ¯å°æ™‚è‡ªå‹•æ›´æ–° | ä¼ºæœå™¨ç‹€æ…‹: <span id="serverStatus" style="color: var(--secondary);">æ­£å¸¸</span></p>
           <p style="margin-top: 15px; font-size: 0.8rem; color: #999;">
               ä½¿ç”¨ Google Apps Script + RSS + HTML/CSS/JavaScript æŠ€è¡“å»ºç½®
           </p>
       </div>
   </div>
  
   <!-- JavaScript ç¨‹å¼ç¢¼ -->
   <script>
       // ç³»çµ±è¨­å®š
       const CONFIG = {
           // è«‹æ›¿æ›ç‚ºä½ çš„ Web App URL
           API_URL: 'https://script.google.com/macros/s/AKfycby-_9Y2ezmU-Li326SeVmCGpeIg6LwaGHF7_5EKng3QlY7sXoP0smrEyboNNLmGW-ui/exec',
           UPDATE_INTERVAL: 300000, // 5åˆ†é˜è‡ªå‹•æ›´æ–° (300000æ¯«ç§’)
           CATEGORY_COLORS: {
               'ç§‘æŠ€': 'category-tech',
               'è²¡ç¶“': 'category-finance',
               'æ”¿æ²»': 'category-politics',
               'å¥åº·': 'category-health',
               'ç’°å¢ƒ': 'category-environment',
               'æ•™è‚²': 'category-education',
               'é‹å‹•': 'category-sports',
               'å¨›æ¨‚': 'category-entertainment',
               'å…¶ä»–': 'category-other'
           },
           CATEGORY_ICONS: {
               'ç§‘æŠ€': 'fas fa-microchip',
               'è²¡ç¶“': 'fas fa-chart-line',
               'æ”¿æ²»': 'fas fa-landmark',
               'å¥åº·': 'fas fa-heartbeat',
               'ç’°å¢ƒ': 'fas fa-leaf',
               'æ•™è‚²': 'fas fa-graduation-cap',
               'é‹å‹•': 'fas fa-running',
               'å¨›æ¨‚': 'fas fa-film',
               'å…¶ä»–': 'fas fa-newspaper'
           }
       };
      
       // å…¨åŸŸç‹€æ…‹
       let currentNews = [];
       let currentFilter = 'all';
       let lastUpdateTime = null;
       let autoUpdateInterval = null;
      
       // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
       document.addEventListener('DOMContentLoaded', function() {
           console.log('æ–°èæ”¶é›†ç³»çµ±å‰ç«¯å•Ÿå‹•...');
          
           // æª¢æŸ¥ä¼ºæœå™¨ç‹€æ…‹
           checkServerStatus();
          
           // è¼‰å…¥æ–°èè³‡æ–™
           loadNews();
          
           // è¨­å®šå®šæ™‚æ›´æ–°
           startAutoUpdate();
          
           // é¡¯ç¤ºç³»çµ±è³‡è¨Š
           updateSystemInfo();
       });
      
       // æª¢æŸ¥ä¼ºæœå™¨ç‹€æ…‹
       async function checkServerStatus() {
           try {
               const response = await fetch(`${CONFIG.API_URL}?action=test`);
               const data = await response.json();
              
               if (data.success) {
                   document.getElementById('serverStatus').innerHTML =
                       `<span style="color: var(--secondary);">æ­£å¸¸ (v${data.version})</span>`;
                   return true;
               } else {
                   document.getElementById('serverStatus').innerHTML =
                       `<span style="color: var(--danger);">ç•°å¸¸</span>`;
                   return false;
               }
           } catch (error) {
               document.getElementById('serverStatus').innerHTML =
                   `<span style="color: var(--danger);">é›¢ç·š</span>`;
               console.error('ä¼ºæœå™¨æª¢æŸ¥å¤±æ•—:', error);
               return false;
           }
       }
      
       // æ¸¬è©¦é€£ç·š
       async function testConnection() {
           showMessage('æ­£åœ¨æ¸¬è©¦ä¼ºæœå™¨é€£ç·š...', 'info');
          
           try {
               const response = await fetch(`${CONFIG.API_URL}?action=test`);
               const data = await response.json();
              
               if (data.success) {
                   showMessage(`âœ… ä¼ºæœå™¨é€£ç·šæ­£å¸¸ (v${data.version})`, 'success');
                   return true;
               } else {
                   showMessage(`âŒ ä¼ºæœå™¨å›æ‡‰ç•°å¸¸: ${data.error || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                   return false;
               }
           } catch (error) {
               showMessage(`âŒ é€£ç·šå¤±æ•—: ${error.message}`, 'error');
               return false;
           }
       }
      
       // è¼‰å…¥æ–°èè³‡æ–™
       async function loadNews() {
           showLoading(true);
           hideError();
          
           try {
               console.log('é–‹å§‹è¼‰å…¥æ–°èè³‡æ–™...');
              
               // ç™¼é€ API è«‹æ±‚
               const response = await fetch(CONFIG.API_URL);
              
               if (!response.ok) {
                   throw new Error(`HTTP éŒ¯èª¤: ${response.status} ${response.statusText}`);
               }
              
               const result = await response.json();
              
               if (!result.success) {
                   throw new Error(result.error || 'ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤');
               }
              
               // è™•ç†è³‡æ–™
               processNewsData(result.data);
               lastUpdateTime = new Date();
              
               // æ›´æ–°ç³»çµ±è³‡è¨Š
               if (result.systemInfo) {
                   updateSystemInfo(result.systemInfo);
               }
              
               console.log('æ–°èè³‡æ–™è¼‰å…¥å®Œæˆ');
               showMessage('âœ… æ–°èè³‡æ–™æ›´æ–°å®Œæˆ', 'success');
              
           } catch (error) {
               console.error('è¼‰å…¥æ–°èè³‡æ–™å¤±æ•—:', error);
               showError(`è¼‰å…¥å¤±æ•—: ${error.message}`);
              
               // å˜—è©¦è¼‰å…¥ç°¡åŒ–ç‰ˆè³‡æ–™
               await loadSimpleNews();
           } finally {
               showLoading(false);
           }
       }
      
       // è¼‰å…¥ç°¡åŒ–ç‰ˆæ–°è (å‚™ç”¨)
       async function loadSimpleNews() {
           console.log('å˜—è©¦è¼‰å…¥ç°¡åŒ–ç‰ˆæ–°è...');
          
           try {
               const response = await fetch(`${CONFIG.API_URL}?action=simple`);
               const result = await response.json();
              
               if (result.success) {
                   processNewsData(result.data);
                   showMessage('âš ï¸ å·²è¼‰å…¥ç°¡åŒ–ç‰ˆæ–°èè³‡æ–™', 'warning');
               }
           } catch (error) {
               console.error('è¼‰å…¥ç°¡åŒ–ç‰ˆæ–°èå¤±æ•—:', error);
           }
       }
      
       // è™•ç†æ–°èè³‡æ–™
       function processNewsData(data) {
           if (!data || !data.news) {
               throw new Error('ç„¡æ•ˆçš„è³‡æ–™æ ¼å¼');
           }
          
           currentNews = data.news || [];
          
           // é¡¯ç¤ºçµ±è¨ˆè³‡æ–™
           displayStatistics(data.statistics);
          
           // é¡¯ç¤ºç†±é–€é—œéµå­—
           displayHotKeywords(data.hotKeywords);
          
           // é¡¯ç¤ºåˆ†é¡ç¯©é¸å™¨
           displayCategoryFilters(data.statistics?.byCategory);
          
           // é¡¯ç¤ºæ–°èåˆ—è¡¨
           displayNewsList(currentNews);
          
           // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“
           updateLastUpdatedTime(data.statistics?.lastUpdated);
          
           // æ›´æ–°ç‹€æ…‹æ¬„
           updateStatusBar();
       }
      
       // é¡¯ç¤ºçµ±è¨ˆè³‡æ–™
       function displayStatistics(statistics) {
           if (!statistics) return;
          
           const totalNews = statistics.total || 0;
           const sourceCount = Object.keys(statistics.bySource || {}).length;
           const categoryCount = Object.keys(statistics.byCategory || {}).length;
          
           document.getElementById('totalNews').textContent = totalNews;
           document.getElementById('totalSources').textContent = sourceCount;
           document.getElementById('totalCategories').textContent = categoryCount;
          
           // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“é¡¯ç¤º
           if (statistics.lastUpdated) {
               const timeStr = formatTime(statistics.lastUpdated);
               document.getElementById('lastUpdateTime').textContent = timeStr.split(' ')[1] || timeStr;
           }
       }
      
       // é¡¯ç¤ºç†±é–€é—œéµå­—
       function displayHotKeywords(keywords) {
           const container = document.getElementById('keywordsContainer');
           const section = document.getElementById('hotKeywordsSection');
          
           if (!keywords || keywords.length === 0) {
               section.style.display = 'none';
               return;
           }
          
           section.style.display = 'block';
          
           let html = '';
           keywords.forEach(keyword => {
               const fontSize = keyword.size || 16;
               html += `
                   <div class="keyword-tag" style="font-size: ${fontSize}px;"
                        onclick="searchByKeyword('${keyword.keyword}')">
                       ${keyword.keyword}
                       <span class="keyword-count">${keyword.count}</span>
                   </div>
               `;
           });
          
           container.innerHTML = html;
       }
      
       // é¡¯ç¤ºåˆ†é¡ç¯©é¸å™¨
       function displayCategoryFilters(categories) {
           const filtersSection = document.getElementById('filtersSection');
          
           if (!categories || Object.keys(categories).length === 0) {
               filtersSection.style.display = 'none';
               return;
           }
          
           filtersSection.style.display = 'flex';
          
           let html = `
               <button class="filter-btn active" onclick="filterNews('all')">
                   å…¨éƒ¨ (${currentNews.length})
               </button>
           `;
          
           Object.entries(categories).forEach(([category, count]) => {
               const icon = CONFIG.CATEGORY_ICONS[category] || 'fas fa-newspaper';
               html += `
                   <button class="filter-btn" onclick="filterNews('${category}')">
                       <i class="${icon}"></i> ${category} (${count})
                   </button>
               `;
           });
          
           filtersSection.innerHTML = html;
       }
      
       // é¡¯ç¤ºæ–°èåˆ—è¡¨
       function displayNewsList(news) {
           const container = document.getElementById('newsContainer');
          
           if (!news || news.length === 0) {
               container.innerHTML = `
                   <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);">
                       <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px;"></i>
                       <h3>æš«ç„¡æ–°èè³‡æ–™</h3>
                       <p>è«‹ç¨å¾Œå†è©¦æˆ–æª¢æŸ¥ç¶²è·¯é€£æ¥</p>
                   </div>
               `;
               return;
           }
          
           let html = '';
           news.forEach(item => {
               const categoryClass = CONFIG.CATEGORY_COLORS[item.category] || 'category-other';
               const categoryIcon = CONFIG.CATEGORY_ICONS[item.category] || 'fas fa-newspaper';
               const sourceIcon = getSourceIcon(item.source);
              
               html += `
                   <div class="news-card">
                       <div class="news-category ${categoryClass}">
                           <i class="${categoryIcon}"></i> ${item.category || 'å…¶ä»–'}
                       </div>
                       <div class="news-content">
                           <h3 class="news-title">${escapeHtml(item.title || 'ç„¡æ¨™é¡Œ')}</h3>
                           <p class="news-summary">${escapeHtml(item.summary || 'ç„¡æ‘˜è¦')}</p>
                           <a href="${item.link || '#'}" class="news-link" target="_blank" rel="noopener noreferrer">
                               <i class="fas fa-external-link-alt"></i> é–±è®€åŸæ–‡
                           </a>
                           <div class="news-meta">
                               <div class="news-source">
                                   <i class="${sourceIcon}"></i> ${item.source || 'æœªçŸ¥ä¾†æº'}
                               </div>
                               <div class="news-date">
                                   ${formatDate(item.date) || formatDate(item.timestamp)}
                               </div>
                           </div>
                       </div>
                   </div>
               `;
           });
          
           container.innerHTML = html;
       }
      
       // ç¯©é¸æ–°è
       function filterNews(category) {
           currentFilter = category;
          
           // æ›´æ–°ç¯©é¸æŒ‰éˆ•ç‹€æ…‹
           document.querySelectorAll('.filter-btn').forEach(btn => {
               btn.classList.remove('active');
           });
          
           if (category === 'all') {
               document.querySelector('.filter-btn').classList.add('active');
               displayNewsList(currentNews);
           } else {
               const filteredNews = currentNews.filter(item => item.category === category);
              
               // æ‰¾åˆ°å°æ‡‰çš„ç¯©é¸æŒ‰éˆ•ä¸¦å•Ÿç”¨
               document.querySelectorAll('.filter-btn').forEach(btn => {
                   if (btn.textContent.includes(category)) {
                       btn.classList.add('active');
                   }
               });
              
               displayNewsList(filteredNews);
           }
       }
      
       // é—œéµå­—æœå°‹
       function searchByKeyword(keyword) {
           const filteredNews = currentNews.filter(item =>
               (item.title && item.title.includes(keyword)) ||
               (item.summary && item.summary.includes(keyword)) ||
               (item.description && item.description.includes(keyword))
           );
          
           currentFilter = 'search';
           displayNewsList(filteredNews);
          
           // æ›´æ–°ç¯©é¸å™¨ç‹€æ…‹
           document.querySelectorAll('.filter-btn').forEach(btn => {
               btn.classList.remove('active');
           });
          
           // é¡¯ç¤ºæœå°‹çµæœæç¤º
           const container = document.getElementById('newsContainer');
           const resultsHeader = `
               <div style="grid-column: 1 / -1; text-align: center; margin-bottom: 20px; color: var(--primary);">
                   <h3><i class="fas fa-search"></i> æœå°‹çµæœï¼š "${keyword}"</h3>
                   <p>æ‰¾åˆ° ${filteredNews.length} å‰‡ç›¸é—œæ–°è</p>
                   <button class="btn btn-outline" onclick="filterNews('all')" style="margin-top: 10px;">
                       <i class="fas fa-times"></i> æ¸…é™¤æœå°‹
                   </button>
               </div>
           `;
          
           container.innerHTML = resultsHeader + container.innerHTML;
       }
      
       // é¡¯ç¤ºçµ±è¨ˆè³‡æ–™è©³æƒ…
       function showStats() {
           if (currentNews.length === 0) {
               showMessage('å°šæœªè¼‰å…¥æ–°èè³‡æ–™', 'warning');
               return;
           }
          
           const categories = {};
           const sources = {};
          
           currentNews.forEach(item => {
               const cat = item.category || 'å…¶ä»–';
               const src = item.source || 'æœªçŸ¥ä¾†æº';
              
               categories[cat] = (categories[cat] || 0) + 1;
               sources[src] = (sources[src] || 0) + 1;
           });
          
           let message = `ğŸ“Š çµ±è¨ˆè³‡è¨Š\n\n`;
           message += `ç¸½æ–°èæ•¸: ${currentNews.length}\n\n`;
           message += `ğŸ“° ä¾†æºåˆ†å¸ƒ:\n`;
           Object.entries(sources).forEach(([source, count]) => {
               message += `  ${source}: ${count} å‰‡\n`;
           });
           message += `\nğŸ·ï¸ åˆ†é¡åˆ†å¸ƒ:\n`;
           Object.entries(categories).forEach(([category, count]) => {
               message += `  ${category}: ${count} å‰‡\n`;
           });
          
           alert(message);
       }
      
       // æ›´æ–°ç‹€æ…‹æ¬„
       function updateStatusBar() {
           // ç‹€æ…‹æ¬„å·²ç”± displayStatistics æ›´æ–°
       }
      
       // æ›´æ–°ç³»çµ±è³‡è¨Š
       function updateSystemInfo(systemInfo) {
           if (systemInfo) {
               console.log(`ç³»çµ±ç‰ˆæœ¬: ${systemInfo.version}, è™•ç†æ™‚é–“: ${systemInfo.executionTime}ms`);
           }
       }
      
       // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“
       function updateLastUpdatedTime(timestamp) {
           const timeStr = timestamp ? formatTime(timestamp) : 'å‰›å‰›';
           document.getElementById('updateTimeText').textContent = timeStr;
       }
      
       // é–‹å§‹è‡ªå‹•æ›´æ–°
       function startAutoUpdate() {
           if (autoUpdateInterval) {
               clearInterval(autoUpdateInterval);
           }
          
           autoUpdateInterval = setInterval(() => {
               console.log('è‡ªå‹•æ›´æ–°æ–°èè³‡æ–™...');
               loadNews();
           }, CONFIG.UPDATE_INTERVAL);
          
           console.log(`å·²è¨­å®šè‡ªå‹•æ›´æ–°ï¼Œé–“éš”: ${CONFIG.UPDATE_INTERVAL / 1000} ç§’`);
       }
      
       // åœæ­¢è‡ªå‹•æ›´æ–°
       function stopAutoUpdate() {
           if (autoUpdateInterval) {
               clearInterval(autoUpdateInterval);
               autoUpdateInterval = null;
               console.log('å·²åœæ­¢è‡ªå‹•æ›´æ–°');
           }
       }
      
       // å·¥å…·å‡½å¼
       function showLoading(show) {
           document.getElementById('loading').style.display = show ? 'block' : 'none';
       }
      
       function showError(message) {
           document.getElementById('errorText').textContent = message;
           document.getElementById('errorMessage').style.display = 'flex';
       }
      
       function hideError() {
           document.getElementById('errorMessage').style.display = 'none';
       }
      
       function showMessage(text, type = 'info') {
           const colors = {
               'info': '#4285f4',
               'success': '#34a853',
               'warning': '#fbbc05',
               'error': '#ea4335'
           };
          
           // ç°¡å–®çš„æç¤ºè¨Šæ¯
           console.log(`${type}: ${text}`);
          
           // å¯ä»¥åœ¨é€™è£¡æ“´å±•é¡¯ç¤ºæ›´æ¼‚äº®çš„æç¤º
       }
      
       function formatTime(timestamp) {
           try {
               const date = new Date(timestamp);
               return date.toLocaleString('zh-TW', {
                   year: 'numeric',
                   month: '2-digit',
                   day: '2-digit',
                   hour: '2-digit',
                   minute: '2-digit',
                   second: '2-digit',
                   hour12: false
               });
           } catch (e) {
               return timestamp || 'æœªçŸ¥æ™‚é–“';
           }
       }
      
       function formatDate(dateStr) {
           try {
               const date = new Date(dateStr);
               return date.toLocaleDateString('zh-TW', {
                   month: '2-digit',
                   day: '2-digit',
                   hour: '2-digit',
                   minute: '2-digit'
               });
           } catch (e) {
               return dateStr || 'æœªçŸ¥æ—¥æœŸ';
           }
       }
      
       function getSourceIcon(source) {
           const icons = {
               'ä¸­å¤®ç¤¾': 'fas fa-landmark',
               'ETtoday': 'fas fa-tv',
               'è‡ªç”±æ™‚å ±': 'fas fa-newspaper',
               'æ¸¬è©¦ä¾†æº': 'fas fa-vial'
           };
           return icons[source] || 'fas fa-rss';
       }
      
       function escapeHtml(text) {
           if (!text) return '';
           const div = document.createElement('div');
           div.textContent = text;
           return div.innerHTML;
       }
      
       // åˆå§‹åŒ–æª¢æŸ¥
       console.log('å‰ç«¯ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
   </script>
</body>
</html>





